<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Free Scala 40 online</title>
    
    <!-- Meta tags from original game -->
    <meta name="Description" content="Play free Scala40 card game online, no registration. Play against the computer. Choose between one, two or three opponents. Gioca Scala 40 gratis online senza registrazione">
	<meta http-Equiv="Cache-Control" Content="no-cache">
	<meta http-Equiv="Pragma" Content="no-cache">
	<meta http-Equiv="Expires" Content="0">

    <link rel="stylesheet" href="scala40V1.css?v=1.2" />

    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-WRBDRDQ4L8"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-WRBDRDQ4L8');
    </script>

    <script>
        // Make the scale factor global so the game's mouse logic can use it
        window.gameScale = 1;

        // Funzione per inviare un evento Google Analytics per un banner
        function sendAnalyticsEvent(bannerElement) {
            if (typeof gtag === 'function') { // Verifica se gtag è disponibile
                const width = bannerElement.style.width;
                const height = bannerElement.style.height;
                const dimensions = width && height ? `${width}x${height}` : 'unknown_dimensions';
                gtag('event', 'simulated_banner_impression', {
                    'event_category': 'Banner_Simulation',
                    'event_label': dimensions,
                    'non_interaction': true // Per non influenzare la frequenza di rimbalzo
                });
                console.log(`GA Evento Inviato: Simulazione Banner - ${dimensions}`); // Per debugging
            } else {
                console.warn('Funzione gtag non trovata. Google Analytics potrebbe non essere inizializzato.');
            }
        }

        // Funzione per tracciare tutti i banner visibili
        function trackVisibleBanners() {
            const visibleBanners = document.querySelectorAll('.ad-banner');
            visibleBanners.forEach(banner => {
                // Verifica base se il banner è visibile (non display:none, o larghezza/altezza 0)
                if (banner.offsetWidth > 0 && banner.offsetHeight > 0) {
                    sendAnalyticsEvent(banner);
                }
            });
        }

        function adjustLayout() {
            const gameWidth = 1024;
            const gameHeight = 750;
            const windowWidth = window.innerWidth;
            const windowHeight = window.innerHeight;

            const campogioco = document.getElementById('campogioco');
            const sidebarLeft = document.getElementById('sidebar-left');
            const sidebarRight = document.getElementById('sidebar-right');

            const scaleX = windowWidth / gameWidth;
            const scaleY = windowHeight / gameHeight;
            const scale = Math.min(scaleX, scaleY);
            
            // Update the global scale for the game logic
            window.gameScale = scale;

            // --- Reverted to prototype's scaling/positioning method ---
            campogioco.style.transform = `translate(-50%, -50%) scale(${scale})`;
            campogioco.style.left = `50%`;
            campogioco.style.top = `50%`;

            // Update the game's internal offsets for correct mouse calculations
            if (window.scala) {
                const rect = campogioco.getBoundingClientRect();
                scala.offsetxx = rect.left;
                scala.offsetyy = rect.top;
            }

            // Sidebar logic remains the same
            const sidebarWidth = (windowWidth - (gameWidth * scale)) / 2;

            sidebarLeft.innerHTML = '';
            sidebarRight.innerHTML = '';
            sidebarLeft.style.display = 'none';
            sidebarRight.style.display = 'none';

            const createBanner = (width, height) => {
                const banner = document.createElement('div');
                banner.className = 'ad-banner';
                banner.style.width = `${width}px`;
                banner.style.height = `${height}px`;
                banner.innerHTML = `Banner<br>${width}x${height}`;
                return banner;
            };

            const allAdFormats = [
                { width: 300, height: 600 }, { width: 300, height: 250 }, { width: 300, height: 100 },
                { width: 160, height: 600 }, { width: 160, height: 250 }, { width: 160, height: 160 },
                { width: 120, height: 600 }, { width: 120, height: 240 }
            ];

            const populateSidebar = (sidebar, availableWidth) => {
                let currentAvailableHeight = windowHeight;
                const verticalGap = 15;
                let bannerWidthFamily = 0;
                if (availableWidth >= 300) bannerWidthFamily = 300;
                else if (availableWidth >= 160) bannerWidthFamily = 160;
                else if (availableWidth >= 120) bannerWidthFamily = 120;

                if (bannerWidthFamily > 0) {
                    const applicableFormats = allAdFormats.filter(f => f.width === bannerWidthFamily);
                    applicableFormats.forEach(format => {
                        const isFirst = sidebar.childElementCount === 0;
                        const requiredGap = isFirst ? 0 : verticalGap;
                        if (currentAvailableHeight >= (format.height + requiredGap)) {
                            const banner = createBanner(format.width, format.height);
                            if (!isFirst) banner.style.marginTop = `${verticalGap}px`;
                            sidebar.appendChild(banner);
                            currentAvailableHeight -= (format.height + requiredGap);
                        } else if (!isFirst && currentAvailableHeight >= format.height) {
                            const banner = createBanner(format.width, format.height);
                            sidebar.appendChild(banner);
                            currentAvailableHeight -= format.height;
                        }
                    });
                }
            };

            if (sidebarWidth >= 120) {
                sidebarLeft.style.width = `${sidebarWidth}px`;
                sidebarRight.style.width = `${sidebarWidth}px`;
                sidebarLeft.style.display = 'flex';
                sidebarRight.style.display = 'flex';
                populateSidebar(sidebarLeft, sidebarWidth);
                populateSidebar(sidebarRight, sidebarWidth);
            }
        }
        
        window.addEventListener('load', () => {
            adjustLayout();
            // Chiamata immediata per il primo invio
            trackVisibleBanners();
            // Poi avvia l'intervallo per i successivi invii ogni minuto
            setInterval(trackVisibleBanners, 60 * 1000); // 1 minuto

            // Ascolta la combinazione di tasti per mostrare/nascondere le sidebar
            document.addEventListener('keydown', (event) => {
                if (event.ctrlKey && event.altKey && event.key === 's') {
                    event.preventDefault(); // Impedisce azioni predefinite del browser
                    document.body.classList.toggle('sidebars-visible');
                    console.log('Sidebar visibility toggled.');
                }
            });
        });
        window.addEventListener('resize', adjustLayout);
    </script>
</head>
<body>

<div class="main-container">
    <div id="sidebar-left" class="sidebar">
        <!-- Banner verranno inseriti qui da JS -->
    </div>
    <div id="sidebar-right" class="sidebar">
        <!-- Banner verranno inseriti qui da JS -->
    </div>

    <div id="campogioco">
      <!-- CONTENT FROM scala40V1.html's #campogioco DIV -->
      <div id="formistruzioni" class="formistruzioni"> 
		<h2>Istruzioni per giocare a scala 40 Luciano:</h2>
		Per pescare dal mazzo: cliccare nell’area “giocatore” oppure sul mazzo.<br><br>
		Per pescare dagli scarti cliccare su di essi.<br><br>
		Per scartare una carta cliccarla con il tasto destro, oppure trascinarla negli scarti,oppure selezionarla e cliccare sugli scarti.<br><br>
		Per riordinare le proprie carte, trascinare la carta che si intende spostare a destra della carta dopo cui si intende inserirla, oppure a sinistra della prima carta.<br><br>
		Per formare un tris cliccare sulle carte che lo compongono, che devono essere ordinate correttamente. Una volta selezionato, si può scartare il tris cliccando nell’area immediatamente superiore a quella del giocatore.<br><br>
		Per aggiungere una carta a un tris o per sostituire un Jolly trascinare la carta nella posizione dove si intende collocare.<br><br>
		Il tasto UNDO permette di annullare la mosse più recenti.<br><br>
		Il tasto SCOPERTE permette di giocare a carte scoperte.<br><br>
		il tasto AVVERSARI consente di scegliere il numeri di avversari e/o iniziare una nuova partita <br><br>
		Per modificare il limite di punti cliccargli sopra<br><br>
		Quando si deposita un tris con jolly, è possibile cambiarne il seme cliccandoci sopra<br><br>To draw from the deck: click in the "player" area or on the deck. <br><br>
		<button class= "bottone1" type="button" >OK</button>
	  </div> 
	   
	  <div id="formhelp" class="formistruzioni"> 
		<h2>How to play scala 40 Luciano:</h2>
		To draw from the deck (mazzo): click in the "player (giocatore)"  area or on the deck. <br> <br>
		To draw from the discard pile (scarti) click on it. <br><br>
		To discard a card, click on it with the right button, or drag it in the discard pile, or select it and click on the discard pile.<br><br>
		To reorder the player cards, move the card that you want to move to the right of the card after which you wish to insert it, or to the left of the first card. <br><br>
		To form a set click on the cards that make it up, which must be ordered correctly. Once selected, you can discard the set clicking in the area immediately above the player area. <br><br>
		To add a card to a set or to replace a Joker pull the card in the position where you want to place it. <br><br>
		The UNDO button undoes the most recent moves. <br><br>
		SCOPERTE (UNCOVERED) button allows you to play with uncovered cards. <br><br>
		AVVERSARI (OPPONENTS) button lets you choose the number of opponents and / or start a new game <br><br>
		To change the score limit (Limite) click on it <br><br>
		When you deposit a set with jokers, you can change the suit clicking on them<br><br>
		<button class= "bottone1" type="button" >OK</button>
	  </div> 

	  <div id="formnuovo" class="formistruzioni"> 
		<h2>Quanti avversari vuoi avere?<br><br>
		How many opponents do you want?</h2>
		<input type="radio" name="avversari" value="1" checked>1<br>
		<input type="radio" name="avversari" value="2" >2<br>
		<input type="radio" name="avversari" value="3" >3<br>
		<button class= "bottone1" type="button" >OK</button>
	  </div> 

	  <div id="haivinto" class="form" style="background-image:url(images/scala40/haivinto.jpg)">  
	  	<button class= "bottone1" type="button" style="left: 200px;" >NUOVA PARTITA</button>
	  </div> 
	   
	  <div id="haiperso" class="form" style="background-image:url(images/scala40/haiperso.jpg)">  
	  	<button class= "bottone1" type="button" style="left: 200px;" >NUOVA PARTITA</button>
	  </div> 

	  <div id="haipersotorneo" class="form" style="background-image:url(images/scala40/haipersotorneo.jpg)">  
	  	<button class= "bottone1" type="button" style="left: 100px;" >NUOVO TORNEO</button>
	  	<button class= "bottone2" type="button" style="left: 300px;" >GIOCA ANCORA</button>
	  </div> 

	  <div id="haivintotorneo" class="form" style="background-image:url(images/scala40/haivintotorneo.jpg)">  
	  	<button class= "bottone1" type="button" style="left: 100px;" >NUOVO TORNEO</button>
	  	<button class= "bottone2" type="button" style="left: 300px;" >GIOCA ANCORA</button>
	  </div> 

	  <div id="oltre40" class="form" style="background-image:url(images/scala40/achtung.jpg)">  
		  <button class= "bottone1" type="button" style="left: 100px;" >ANNULLA APERTURA</button>
		  <button class= "bottone2" type="button" style="left: 300px;" >CONTINUA</button>
	  </div> 

	  <div id="allerta" class="form" style="background-image:url(images/scala40/allerta.jpg)">
	  		<div id="testoallerta"> prova </div>
	  		<button class= "bottone1" type="button" style="left: 200px;" >OK</button>
	  </div> 

	   <div id="totalizzatore"  class="totalizzatore">
	   		<div id="azzeratotale" class="pulsanteazz" style="top: 260px; left: 12px; z-index:1000; ">AZZERA</div> 
	   </div>
	   
	   <div id="nonpertest">
			<div id="istruzioni" class="pulsante2" style="top: 5px; left: 10px; z-index:1000">ISTRUZIONI</div> 
			<div id="nuovo" class="pulsante2" style="top: 53px; left: 10px; z-index:1000">AVVERSARI</div>
	    </div>
	    <div id="pulsante2" class="pulsante2" style="top: 5px; left: 878px; z-index:1000">UNDO (0)</div> 
	    <div id="scoperte" class="pulsante2" style="top: 53px; left: 878px; z-index:1000">SCOPERTE</div> 
	   
	     <div id="mazzo"><span>mazzo</span></div>
	     <div id="scarti"><span>scarti</span></div>

		<div class="pulsantehelp" style="top: 705px; left:10px; "></div>
		<div class="pulsantecomments" style="top: 702px; left: 150px; "></div>
		
		<a href="spider.html"><div class="pulsantespider" style="top: 702px; left: 600px; "></div></a>
		<a href="machiavelli.html"><div class="pulsantemachiavelli" style="top: 702px; left: 740px; "></div></a>
		<a href="index.html"><div class="pulsanteback" style="top: 702px; left: 880px; "></div></a>
	  
	  	<div style="position:absolute; top: 00px; left: 210px;"><img src="images/scala40/dorata.png"   height="150px" width="650px"></div>
    </div>
</div>

<!-- Audio tags from scala40V1.html -->
<audio id="pesca" src="sounds/scala40/cardplace1.mp3"></audio>
<audio id="scartatris" src="sounds/scala40/cardplace3.mp3"></audio>
<audio id="ordina" src="sounds/scala40/cardslide5.mp3"></audio>
<audio id="scarta" src="sounds/scala40/cardslide1.mp3"></audio>
<audio id="perjolly" src="sounds/scala40/chimes.mp3"></audio>
<audio id="tada" src="sounds/scala40/tada.mp3"></audio>
<audio id="perso" src="sounds/scala40/haiperso.mp3"></audio>
<audio id="dascarti" src="sounds/scala40/magic.mp3"></audio>
<audio id="slitta" src="sounds/scala40/slitta.mp3"></audio>
<audio id="ding" src="sounds/scala40/ding.mp3"></audio>
<audio id="thunder" src="sounds/scala40/thunder.mp3"></audio>
<audio id="applause" src="sounds/scala40/applause.mp3"></audio>
<audio id="distribuisci" src="sounds/scala40/distribuisci.mp3"></audio>

<!-- Scripts for game logic -->
<script src="jquery-2.1.1.js"></script>
<script src="scala40codeV1.js?v=1.2"></script>

</body>
</html>
